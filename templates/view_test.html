{% extends 'base.html' %}

{% block title %}
Xem ƒê·ªÅ: {{ test.title }}
{% endblock %}

{% block content %}
<div class="flex h-screen bg-gray-100 font-sans">

    <aside class="w-64 bg-indigo-700 text-white p-6 space-y-6 flex-shrink-0">
        <h1 class="text-2xl font-bold mb-6">Admin Dashboard</h1>
        <nav class="space-y-3">
            <a href="{{ url_for('admin.admin_panel', section='users') }}"
                class="block py-2 px-3 rounded hover:bg-indigo-600 transition">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a>
            <a href="{{ url_for('admin.admin_panel', section='add_test') }}"
                class="block py-2 px-3 rounded hover:bg-indigo-600 transition">üìù Th√™m ƒë·ªÅ m·ªõi</a>
            <a href="{{ url_for('admin.admin_panel', section='view_tests') }}"
                class="block py-2 px-3 rounded hover:bg-indigo-600 transition bg-indigo-800">üìö Xem c√°c ƒë·ªÅ ƒë√£ th√™m</a>
            <a href="{{ url_for('index') }}" class="block py-2 px-3 rounded hover:bg-indigo-600 transition">üè† V·ªÅ
                trang ch·ªß</a>
            <a href="{{ url_for('auth.logout') }}"
                class="block py-2 px-3 rounded hover:bg-indigo-600 transition text-red-300">üö™ ƒêƒÉng xu·∫•t</a>
        </nav>
    </aside>

    <main class="flex-1 p-8 overflow-y-auto">
        <section class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-lg shadow-lg">

            <h1 class="text-3xl font-bold text-indigo-700 mb-2">{{ test.title }}</h1>
            <p class="text-lg text-gray-600 mb-4">Lo·∫°i ƒë·ªÅ: <span class="font-semibold">{{ test.category }}</span></p>

            {% if test.category == 'Listening' and test.audio_url %}
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-2">Audio</h2>
                <audio controls class="w-full">
                    <source src="{{ test.audio_url }}" type="audio/mpeg">
                    Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ file audio.
                </audio>
            </div>
            {% endif %}

            <hr class="my-6">

            <div class="space-y-8">
                {% for passage in sorted_passages %}
                <article class="passage-block border rounded-lg p-4 sm:p-6 bg-gray-50/70">
                    <h2 class="text-2xl font-semibold text-purple-700 mb-4">
                        {% if test.category == 'Listening' %}
                        Section {{ loop.index }}
                        {% else %}
                        ƒêo·∫°n vƒÉn (Passage) {{ loop.index }}
                        {% endif %}
                    </h2>

                    {% if test.category == 'Reading' %}
                    <div class="prose prose-indigo max-w-none text-gray-800 mb-6 whitespace-pre-wrap">
                        {{ passage.passage_text }}
                    </div>
                    {% endif %}

                    <div class="questions-area space-y-6">
                        <h3 class="text-xl font-semibold text-gray-800 border-b border-gray-300 pb-2">C√°c c√¢u h·ªèi</h3>

                        {% for q in passage.sorted_questions %}
                        {% set extra = json.loads(q.extra_data) if q.extra_data else {} %}

                        <div class="question-block border rounded p-4 bg-white shadow-sm">

                            <div class="flex justify-between items-center mb-2">
                                <h4 class="text-lg font-bold text-indigo-800">C√¢u h·ªèi: {{ q.question_range }}</h4>
                                <span class="text-sm text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">{{
                                    q.question_type }}</span>
                            </div>

                            <p class="font-medium text-gray-700 mb-3 whitespace-pre-wrap">{{ q.instruction_text }}</p>

                            {% if q.question_type in ['fill_in_blank', 'true_false_not_given', 'yes_no_not_given'] %}
                            <div class="bg-green-50 border border-green-200 p-3 rounded">
                                <strong class="text-green-800">ƒê√°p √°n:</strong>
                                <code class="ml-2 text-green-700 font-semibold">{{ q.simple_answer }}</code>
                            </div>
                            {% endif %}

                            {% if q.question_type == 'multiple_choice' %}
                            <div class="space-y-2 mb-3">
                                <h5 class="text-sm font-semibold text-gray-600">C√°c l·ª±a ch·ªçn:</h5>
                                <ul class="list-disc list-inside pl-4 text-gray-700">
                                    {% for option in extra.get('options', []) %}
                                    <li>{{ option }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="bg-green-50 border border-green-200 p-3 rounded">
                                <strong class="text-green-800">ƒê√°p √°n ƒë√∫ng:</strong>
                                <code class="ml-2 text-green-700 font-semibold">{{ q.simple_answer }}</code>
                            </div>
                            {% endif %}

                            {% if q.question_type == 'matching' %}
                            {% if extra.get('matching_items') %}
                            <div class="mb-3">
                                <h5 class="text-sm font-semibold text-gray-600">Danh s√°ch Items (ƒë·ªÉ n·ªëi):</h5>
                                <div class="p-3 bg-gray-100 rounded border text-sm">
                                    <ul class="list-decimal list-inside">
                                        {% for item in extra.get('matching_items', []) %}
                                        <li>{{ item }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            {% endif %}

                            <div class="space-y-2">
                                <h5 class="text-sm font-semibold text-gray-600">C√°c c√¢u h·ªèi con v√† ƒë√°p √°n:</h5>
                                <table class="min-w-full border text-sm">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="px-3 py-2 border text-left">C√¢u h·ªèi (List A)</th>
                                            <th class="px-3 py-2 border text-left text-green-800">ƒê√°p √°n (List B)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for sub_q in extra.get('sub_questions', []) %}
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-3 py-2 border">{{ sub_q.query }}</td>
                                            <td class="px-3 py-2 border font-semibold text-green-700">{{ sub_q.answer }}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% endif %}

                        </div>
                        {% else %}
                        <p class="italic text-gray-500">Kh√¥ng c√≥ c√¢u h·ªèi n√†o cho passage n√†y.</p>
                        {% endfor %}
                    </div>
                </article>
                {% else %}
                <p class="text-center text-gray-600 italic">ƒê·ªÅ thi n√†y kh√¥ng c√≥ passage/section n√†o.</p>
                {% endfor %}
            </div>

        </section>
    </main>
</div>
{% endblock %}